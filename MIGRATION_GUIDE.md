# üîÑ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìã –ß—Ç–æ —Ç–∞–∫–æ–µ –º–∏–≥—Ä–∞—Ü–∏–∏?

–ú–∏–≥—Ä–∞—Ü–∏–∏ - —ç—Ç–æ —Å–ø–æ—Å–æ–± –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –¥–∞–Ω–Ω—ã—Ö. –û–Ω–∏ –ø–æ–∑–≤–æ–ª—è—é—Ç:
- ‚úÖ –î–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –∏ —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ –ò–∑–º–µ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- ‚úÖ –û—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

### **1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python migrations.py migrate

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
python migrations.py status

# –û—Ç–∫–∞—Ç–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
python migrations.py rollback add_player_stats_fields
```

### **2. –ù–∞ Railway (–ø—Ä–æ–¥–∞–∫—à–Ω)**

#### **–í–∞—Ä–∏–∞–Ω—Ç A: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏**
–ú–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `init_db()`.

#### **–í–∞—Ä–∏–∞–Ω—Ç B: –†—É—á–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏**
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Railway —á–µ—Ä–µ–∑ CLI –∏–ª–∏ SSH
railway login
railway link
railway shell

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
python migrations.py migrate
```

## üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

### **1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é –≤ `migrations.py`:**

```python
# –í —Ñ—É–Ω–∫—Ü–∏–∏ run_all_migrations()
migrator.run_migration(
    "your_migration_name",
    [
        "ALTER TABLE players ADD COLUMN IF NOT EXISTS new_field VARCHAR(100)",
        "UPDATE players SET new_field = 'default_value' WHERE new_field IS NULL"
    ],
    "Description of what this migration does"
)
```

### **2. –î–æ–±–∞–≤—å—Ç–µ rollback SQL:**

```python
# –í —Å–ª–æ–≤–∞—Ä–µ rollback_sql
"your_migration_name": [
    "ALTER TABLE players DROP COLUMN IF EXISTS new_field"
]
```

## üîß –¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π

### **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è**
```sql
-- –ú–∏–≥—Ä–∞—Ü–∏—è
ALTER TABLE players ADD COLUMN IF NOT EXISTS phone VARCHAR(20);

-- Rollback
ALTER TABLE players DROP COLUMN IF EXISTS phone;
```

### **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ –ø–æ–ª—è**
```sql
-- –ú–∏–≥—Ä–∞—Ü–∏—è (—Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –ø–æ–ª–µ, –∫–æ–ø–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ, —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ)
ALTER TABLE players ADD COLUMN new_field INTEGER;
UPDATE players SET new_field = CAST(old_field AS INTEGER);
ALTER TABLE players DROP COLUMN old_field;
ALTER TABLE players RENAME COLUMN new_field TO old_field;

-- Rollback (–æ–±—Ä–∞—Ç–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)
ALTER TABLE players ADD COLUMN old_field TEXT;
UPDATE players SET old_field = CAST(new_field AS TEXT);
ALTER TABLE players DROP COLUMN new_field;
ALTER TABLE players RENAME COLUMN old_field TO new_field;
```

### **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞**
```sql
-- –ú–∏–≥—Ä–∞—Ü–∏—è
CREATE INDEX IF NOT EXISTS idx_players_name ON players(name);

-- Rollback
DROP INDEX IF EXISTS idx_players_name;
```

### **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**
```sql
-- –ú–∏–≥—Ä–∞—Ü–∏—è
ALTER TABLE players ADD CONSTRAINT check_name_length CHECK (LENGTH(name) > 0);

-- Rollback
ALTER TABLE players DROP CONSTRAINT IF EXISTS check_name_length;
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### **1. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `IF NOT EXISTS` –∏ `IF EXISTS`
- ‚úÖ –î–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –∫–æ–ø–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### **2. –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –í–∫–ª—é—á–∞–π—Ç–µ –¥–∞—Ç—É –≤ –∏–º—è –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –ü—Ä–∏–º–µ—Ä: `add_player_stats_2024_01_15`

### **3. Rollback**
- ‚úÖ –í—Å–µ–≥–¥–∞ –ø–∏—à–∏—Ç–µ rollback SQL
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ rollback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£—á–∏—Ç—ã–≤–∞–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

## üö® –û–ø–∞—Å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### **–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π/—Ç–∞–±–ª–∏—Ü**
```sql
-- –û—á–µ–Ω—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ! –ú–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ
ALTER TABLE players DROP COLUMN field_name;
DROP TABLE table_name;
```

### **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π**
```sql
-- –¢—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–π –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏
ALTER TABLE players DROP CONSTRAINT players_pkey;
ALTER TABLE players ADD PRIMARY KEY (new_field);
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–∏–≥—Ä–∞—Ü–∏–π

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞**
```bash
python migrations.py status
```

### **–ü—Ä–æ—Å–º–æ—Ç—Ä –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**
```sql
SELECT * FROM migrations ORDER BY applied_at DESC;
```

### **–õ–æ–≥–∏ Railway**
```bash
railway logs
# –ò—â–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ –º–∏–≥—Ä–∞—Ü–∏—è—Ö
```

## üîÑ Workflow –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### **1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**
```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
# 2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ
python migrations.py migrate
python migrations.py status

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ rollback
python migrations.py rollback your_migration_name
python migrations.py migrate  # –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–Ω–æ–≤–∞
```

### **2. –ü—Ä–æ–¥–∞–∫—à–Ω**
```bash
# 1. –°–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
railway backup

# 2. –î–µ–ø–ª–æ–π—Ç–µ –∫–æ–¥ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
git push railway main

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
railway logs

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
railway shell
python migrations.py status
```

### **3. –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)**
```bash
# 1. –û—Ç–∫–∞—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
railway shell
python migrations.py rollback problematic_migration

# 2. –ò–ª–∏ –æ—Ç–∫–∞—Ç–∏—Ç–µ –≤–µ—Å—å –¥–µ–ø–ª–æ–π
railway rollback
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Railway
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SQL —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
4. –°–æ–∑–¥–∞–π—Ç–µ issue —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã

## üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏** –Ω–∞ –∫–æ–ø–∏–∏ –ø—Ä–æ–¥–∞–∫—à–Ω –¥–∞–Ω–Ω—ã—Ö
2. **–î–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏** –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
5. **–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ rollback** –∑–∞—Ä–∞–Ω–µ–µ
6. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π 